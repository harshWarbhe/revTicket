<div class="page-wrapper">
  <!-- HEADER -->
  <header class="page-header">
    <div>
      <h1 class="page-title">Manage Theatres</h1>
      <p class="page-subtitle">View and manage all theatres in your system</p>
    </div>
    <button class="btn-add" (click)="addTheatre()" [disabled]="loading()">
      <span>+</span>
      <span>Add Theatre</span>
    </button>
  </header>

  <!-- FILTERS -->
  @if (!showForm()) {
  <section class="filters-bar">
    <div class="search-box">
      <input type="text" 
             class="search-input" 
             placeholder="Search theatres..." 
             [value]="searchTerm()" 
             (input)="onSearchChange($any($event.target).value)">
      <span class="search-icon">üîç</span>
    </div>

    <select class="filter-dropdown" 
            [value]="selectedCity()" 
            (change)="selectedCity.set($any($event.target).value); onFilterChange()">
      <option value="">All Cities</option>
      @for (city of cities(); track $index) {
        <option [value]="city">{{ city }}</option>
      }
    </select>

    <select class="filter-dropdown" 
            [value]="selectedStatus()" 
            (change)="selectedStatus.set($any($event.target).value); onFilterChange()">
      <option value="">All Status</option>
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select>
  </section>
  }

  <!-- ADD/EDIT FORM -->
  @if (showForm()) {
  <section class="form-section">
    <div class="form-panel">
      <div class="form-header">
        <h3>{{ editingTheatreId() ? 'Edit Theatre' : 'Add New Theatre' }}</h3>
        <button class="btn-close" (click)="cancelForm()">‚úï</button>
      </div>

      <form [formGroup]="theatreForm" (ngSubmit)="submitTheatre()" class="form-body">
        <div class="form-grid">
          <div class="form-field" [class.error]="isInvalid('name')">
            <label>Theatre Name *</label>
            <input type="text" formControlName="name" placeholder="e.g., PVR Icon">
            @if (isInvalid('name')) {
              <span class="error-msg">Name is required</span>
            }
          </div>

          <div class="form-field" [class.error]="isInvalid('location')">
            <label>City / Location *</label>
            <input type="text" formControlName="location" placeholder="e.g., Mumbai">
            @if (isInvalid('location')) {
              <span class="error-msg">Location is required</span>
            }
          </div>

          <div class="form-field full" [class.error]="isInvalid('address')">
            <label>Address *</label>
            <textarea formControlName="address" rows="2" placeholder="Full address"></textarea>
            @if (isInvalid('address')) {
              <span class="error-msg">Address is required</span>
            }
          </div>

          <div class="form-field" [class.error]="isInvalid('totalScreens')">
            <label>Total Screens *</label>
            <input type="number" formControlName="totalScreens" min="1" placeholder="e.g., 5">
            @if (isInvalid('totalScreens')) {
              <span class="error-msg">At least 1 screen required</span>
            }
          </div>

          <div class="form-field">
            <label>Status *</label>
            <select formControlName="isActive">
              <option [ngValue]="true">Active</option>
              <option [ngValue]="false">Inactive</option>
            </select>
          </div>

          <div class="form-field full">
            <label>Theatre Image</label>
            <input type="file" accept="image/*" (change)="previewFile($event)">
            <input type="url" formControlName="imageUrl" placeholder="Or enter image URL" (input)="imagePreview.set($any($event.target).value)">
            @if (imagePreview() && isImage(imagePreview())) {
              <div class="preview-box">
                <img [src]="imagePreview()" alt="Theatre preview" class="preview-img">
              </div>
            }
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="cancelForm()" [disabled]="submitting()">
            Cancel
          </button>
          <button type="submit" class="btn-save" [disabled]="theatreForm.invalid || submitting()">
            {{ submitting() ? 'Saving...' : (editingTheatreId() ? 'Update' : 'Add Theatre') }}
          </button>
        </div>
      </form>
    </div>
  </section>
  }

  <!-- LOADING -->
  @if (loading()) {
  <section class="loading-state">
    <div class="spinner"></div>
    <p>Loading theatres...</p>
  </section>
  }

  <!-- THEATRES GRID -->
  @if (!loading() && filteredTheatres().length > 0 && !showForm()) {
  <section class="theatres-grid">
    @for (theatre of filteredTheatres(); track trackByTheatreId($index, theatre)) {
    <div class="theatre-card">
      <div class="card-header">
        <h3 class="theatre-name">{{ theatre.name }}</h3>
        <span class="status-pill" [class.active]="theatre.isActive" [class.inactive]="!theatre.isActive">
          {{ theatre.isActive ? 'ACTIVE' : 'INACTIVE' }}
        </span>
      </div>
      
      <div class="card-info">
        <span class="info-tag">üìç {{ theatre.location }}</span>
        <span class="divider">|</span>
        <span class="info-tag">üé¨ {{ theatre.totalScreens || 0 }} Screens</span>
      </div>
      
      <div class="card-address">
        Address: {{ theatre.address }}
      </div>
      
      <div class="card-actions">
        <button class="action-btn screens" (click)="viewScreens(theatre.id)">Screens</button>
        <button class="action-btn edit" (click)="editTheatre(theatre)">Edit</button>
        <button class="action-btn pause" 
                (click)="toggleStatus(theatre)"
                [disabled]="statusUpdatingId() === theatre.id">
          {{ statusUpdatingId() === theatre.id ? 'Updating...' : (theatre.isActive ? 'Pause' : 'Resume') }}
        </button>
        <button class="action-btn delete" 
                (click)="deleteTheatre(theatre)" 
                [disabled]="deletingId() === theatre.id">
          {{ deletingId() === theatre.id ? 'Deleting...' : 'Delete' }}
        </button>
      </div>
    </div>
    }
  </section>
  }

  <!-- EMPTY STATE -->
  @if (!loading() && filteredTheatres().length === 0 && !showForm()) {
  <section class="empty-state">
    <div class="empty-icon">üé≠</div>
    <h3>No Theatres Found</h3>
    <p>{{ searchTerm() || selectedCity() || selectedStatus() ? 'Try adjusting your filters' : 'Add your first theatre to get started' }}</p>
    @if (!searchTerm() && !selectedCity() && !selectedStatus()) {
    <button class="btn-add" (click)="addTheatre()">
      <span>+</span>
      <span>Add Theatre</span>
    </button>
    }
  </section>
  }
</div>
