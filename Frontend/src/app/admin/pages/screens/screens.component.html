<div class="page-wrapper">
  <header class="page-header">
    <div>
      <h1 class="page-title">Screen Layout Designer</h1>
      <p class="page-subtitle">Quick and easy seat category assignment</p>
    </div>
  </header>

  <!-- SELECTION -->
  <section class="selection-panel">
    <div class="selection-grid">
      <div class="selection-field">
        <label class="selection-label">Select Theatre</label>
        <select 
          class="selection-dropdown" 
          [(ngModel)]="selectedTheatreId"
          (ngModelChange)="onTheatreChange()"
          [disabled]="loading()">
          <option value="">Choose a theatre...</option>
          @for (theatre of theatres(); track theatre.id) {
            <option [value]="theatre.id">{{ theatre.name }}</option>
          }
        </select>
      </div>

      @if (selectedTheatreId() && availableScreens().length > 0) {
        <div class="selection-field">
          <label class="selection-label">Select Screen</label>
          <select 
            class="selection-dropdown" 
            [(ngModel)]="selectedScreenNumber"
            (ngModelChange)="onScreenChange()"
            [disabled]="loading()">
            <option [value]="0">Choose a screen...</option>
            @for (screenNum of availableScreens(); track screenNum) {
              <option [value]="screenNum">Screen {{ screenNum }}</option>
            }
          </select>
        </div>
      }
    </div>
  </section>

  @if (selectedTheatre()) {
    <section class="theatre-info-card">
      <div class="info-header">
        <div class="info-icon">üé¨</div>
        <div class="info-content">
          <h3 class="info-title">{{ selectedTheatre()!.name }}</h3>
          <p class="info-location">{{ selectedTheatre()!.location }}</p>
        </div>
      </div>
    </section>
  }

  @if (loading()) {
    <section class="loading-state">
      <div class="spinner"></div>
      <p>Loading...</p>
    </section>
  }

  @if (selectedScreenNumber() && !loading()) {
    <!-- QUICK CONFIG -->
    <section class="config-panel">
      <h3 class="section-title">Layout Configuration</h3>
      <div class="config-row">
        <div class="config-item">
          <label>Rows</label>
          <input type="number" [(ngModel)]="rows" (ngModelChange)="updateRows()" min="1" max="26">
        </div>
        <div class="config-item">
          <label>Seats Per Row</label>
          <input type="number" [(ngModel)]="seatsPerRow" (ngModelChange)="updateSeatsPerRow()" min="1" max="50">
        </div>
        <div class="config-item">
          <label>Total Seats</label>
          <div class="display-value">{{ totalSeats() }}</div>
        </div>
        <div class="config-item">
          <label>Available</label>
          <div class="display-value green">{{ availableSeatsCount() }}</div>
        </div>
      </div>
    </section>

    <!-- CATEGORY MANAGEMENT -->
    <section class="assignment-panel">
      <div class="section-header">
        <h3 class="section-title">Seat Categories</h3>
        <button class="btn-add-cat" (click)="showAddCategory.set(true)">+ Add Category</button>
      </div>
      
      <div class="pricing-grid">
        @for (cat of categories(); track cat.id) {
          <div class="pricing-item">
            <div class="pricing-color" [style.background]="cat.color"></div>
            <div class="pricing-info">
              <label>{{ cat.name }}</label>
              <input 
                type="number" 
                [(ngModel)]="cat.price" 
                (ngModelChange)="updateCategoryPrice(cat.id, cat.price)"
                placeholder="Enter price"
                min="0">
            </div>
            <button class="btn-delete-cat" (click)="deleteCategory(cat.id)">‚úï</button>
          </div>
        }
      </div>

      @if (showAddCategory()) {
        <div class="add-category-form">
          <div class="form-row">
            <input type="text" [(ngModel)]="newCategoryName" placeholder="Category Name" class="form-input">
            <input type="number" [(ngModel)]="newCategoryPrice" placeholder="Price" class="form-input" min="0">
            <input type="color" [(ngModel)]="newCategoryColor" class="form-color">
            <button class="btn-save-cat" (click)="addCategory()">Add</button>
            <button class="btn-cancel-cat" (click)="showAddCategory.set(false)">Cancel</button>
          </div>
        </div>
      }
    </section>

    <!-- BULK ASSIGNMENT -->
    <section class="assignment-panel">
      <h3 class="section-title">Seat Assignment Tools</h3>
      
      <div class="quick-actions">
        <button class="btn-quick danger" (click)="clearAll()">
          üóëÔ∏è Clear All
        </button>
      </div>

      <div class="range-builder">
        <h4>Assign Category by Row Range</h4>
        
        @for (range of rowRanges(); track $index) {
          <div class="range-row">
            <select [(ngModel)]="range.categoryId" class="range-select">
              <option value="">Select Category</option>
              @for (cat of categories(); track cat.id) {
                <option [value]="cat.id">{{ cat.name }} (‚Çπ{{ cat.price }})</option>
              }
            </select>
            
            <div class="range-inputs">
              <span>From Row</span>
              <select [(ngModel)]="range.startRow" class="row-select">
                @for (r of [].constructor(rows()); track r; let idx = $index) {
                  <option [value]="idx">{{ getRowLabel(idx) }}</option>
                }
              </select>
              
              <span>To Row</span>
              <select [(ngModel)]="range.endRow" class="row-select">
                @for (r of [].constructor(rows()); track r; let idx = $index) {
                  <option [value]="idx">{{ getRowLabel(idx) }}</option>
                }
              </select>
            </div>
            
            <button class="btn-remove" (click)="removeRowRange($index)">‚úï</button>
          </div>
        }
        
        <div class="range-actions">
          <button class="btn-add-range" (click)="addRowRange()">+ Add Range</button>
          <button class="btn-apply" (click)="applyRowRanges()" [disabled]="rowRanges().length === 0">
            Apply Ranges
          </button>
        </div>
      </div>


    </section>

    <!-- INTERACTIVE SEAT LAYOUT -->
    <section class="preview-panel">
      <h3 class="section-title">Interactive Seat Layout</h3>
      
      <div class="screen-indicator">
        <div class="screen-label">SCREEN</div>
      </div>

      <div class="legend">
        @for (cat of categories(); track cat.id) {
          <div class="legend-item">
            <div class="legend-box" [style.background]="cat.color"></div>
            <span>{{ cat.name }} (‚Çπ{{ cat.price }})</span>
          </div>
        }
        <div class="legend-item">
          <div class="legend-box disabled"></div>
          <span>Disabled</span>
        </div>
      </div>

      <div class="instruction-box">
        <p>üí° <strong>Click any seat</strong> to disable/enable it manually</p>
      </div>

      <div class="seat-layout">
        @for (rowIdx of [].constructor(rows()); track rowIdx; let r = $index) {
          <div class="seat-row-interactive">
            <span class="row-label-interactive">{{ getRowLabel(r) }}</span>
            <div class="seats-interactive">
              @for (seat of getSeatsForRow(r); track seat.label) {
                <button 
                  class="seat-interactive"
                  [class.seat-disabled]="seat.disabled"
                  [style.background]="getSeatBackground(seat)"
                  [title]="seat.label + (seat.disabled ? ' (Disabled)' : '')"
                  (click)="toggleSeatDisabled(seat)">
                  <span class="seat-label">{{ seat.label }}</span>
                </button>
              }
            </div>
          </div>
        }
      </div>

      <div class="stats-bar">
        <div class="stat">
          <strong>Revenue per Show:</strong> ‚Çπ{{ totalRevenue() }}
        </div>
        @for (cat of categories(); track cat.id) {
          @if (categoryCounts().get(cat.id)) {
            <div class="stat">
              <strong>{{ cat.name }}:</strong> {{ categoryCounts().get(cat.id) }} seats
            </div>
          }
        }
      </div>
    </section>

    <!-- SAVE -->
    <section class="save-section">
      <button 
        class="btn-save-main" 
        (click)="saveScreen()"
        [disabled]="saving()">
        {{ saving() ? 'Saving...' : 'Save Screen Layout' }}
      </button>
    </section>
  }

  @if (!selectedTheatreId() && !loading()) {
    <section class="empty-state">
      <div class="empty-icon">üé¨</div>
      <h3>Select a Theatre</h3>
      <p>Choose a theatre to start</p>
    </section>
  }

  @if (selectedTheatreId() && !selectedScreenNumber() && !loading()) {
    <section class="empty-state">
      <div class="empty-icon">üéûÔ∏è</div>
      <h3>Select a Screen</h3>
      <p>Choose a screen to configure</p>
    </section>
  }
</div>
