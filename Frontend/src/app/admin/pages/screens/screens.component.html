<div class="container">
  <div class="header">
    <h1>üé¨ Screen Configuration</h1>
    <p>Configure seat layout, categories, and pricing for theatre screens</p>
  </div>

  <!-- Theatre & Screen Selection -->
  <div class="selection-panel">
    <div class="field">
      <label for="theatre-select">Theatre</label>
      <select 
        id="theatre-select"
        [ngModel]="selectedTheatreId()" 
        (ngModelChange)="selectedTheatreId.set($event); onTheatreChange()"
        [disabled]="loading()"
        aria-label="Select theatre">
        <option value="">Select Theatre</option>
        <option *ngFor="let t of theatres()" [value]="t.id">
          {{ t.name }} - {{ t.location }}
        </option>
      </select>
    </div>

    <div class="field" *ngIf="selectedTheatreId()">
      <label for="screen-select">Screen</label>
      <select 
        id="screen-select"
        [ngModel]="selectedScreenId()" 
        (ngModelChange)="selectedScreenId.set($event); onScreenChange()"
        [disabled]="loading()"
        aria-label="Select screen">
        <option value="">Select Screen</option>
        <option value="new">+ Create New Screen</option>
        <option *ngFor="let screen of screens()" [value]="screen.id">
          {{ screen.name }}
        </option>
      </select>
    </div>
  </div>

  <!-- Validation Errors -->
  <div class="validation-errors" *ngIf="validationErrors().length > 0">
    <div class="error-header">‚ö†Ô∏è Please fix the following errors:</div>
    <ul>
      <li *ngFor="let error of validationErrors()">{{ error }}</li>
    </ul>
  </div>

  <!-- Main Configuration Area -->
  <div *ngIf="selectedScreenId()" class="config-area">
    
    <!-- Screen Name & Layout -->
    <div class="config-section">
      <h3>Screen Details & Layout</h3>
      <div class="config-grid">
        <div class="input-group">
          <label for="screen-name">Screen Name</label>
          <input 
            id="screen-name"
            type="text" 
            [ngModel]="screenName()" 
            (ngModelChange)="screenName.set($event); hasUnsavedChanges.set(true)"
            placeholder="e.g., Screen 1"
            aria-label="Screen name">
        </div>
        
        <div class="input-group">
          <label for="rows-input">Rows (A-Z)</label>
          <input 
            id="rows-input"
            type="number" 
            [ngModel]="rows()" 
            (ngModelChange)="rows.set($event); hasUnsavedChanges.set(true)" 
            (blur)="onLayoutChange()" 
            min="1" 
            max="26"
            aria-label="Number of rows">
        </div>
        
        <div class="input-group">
          <label for="seats-input">Seats per Row</label>
          <input 
            id="seats-input"
            type="number" 
            [ngModel]="seatsPerRow()" 
            (ngModelChange)="seatsPerRow.set($event); hasUnsavedChanges.set(true)" 
            (blur)="onLayoutChange()" 
            min="1" 
            max="50"
            aria-label="Seats per row">
        </div>
        
        <div class="stat">
          <label>Total Active Seats</label>
          <div class="value">{{ totalSeats() }}</div>
        </div>
      </div>
    </div>

    <!-- Categories & Pricing -->
    <div class="categories-section">
      <div class="section-header">
        <h3>Seat Categories & Pricing</h3>
        <button 
          (click)="addCategory()" 
          class="btn-add"
          aria-label="Add new category">
          + Add Category
        </button>
      </div>
      
      <div class="categories-grid">
        <div *ngFor="let cat of categories()" class="category-card">
          <div 
            class="color-box" 
            [style.background]="cat.color"
            [attr.aria-label]="'Category color: ' + cat.color"></div>
          
          <input 
            type="text" 
            [ngModel]="cat.name"
            (ngModelChange)="updateCategory(cat.id, 'name', $event)"
            placeholder="Category Name" 
            class="cat-name"
            [attr.aria-label]="'Category name: ' + cat.name">
          
          <div class="price-input">
            <span>‚Çπ</span>
            <input 
              type="number" 
              [ngModel]="cat.price"
              (ngModelChange)="updateCategory(cat.id, 'price', $event)"
              min="0"
              [attr.aria-label]="'Price for ' + cat.name">
          </div>
          
          <input 
            type="color" 
            [ngModel]="cat.color"
            (ngModelChange)="updateCategory(cat.id, 'color', $event)"
            class="color-picker"
            [attr.aria-label]="'Color picker for ' + cat.name">
          
          <span class="inherit-badge" *ngIf="cat.inheriting" title="Inheriting from theatre defaults">
            üîó Inherited
          </span>
          
          <button 
            *ngIf="categories().length > 1" 
            (click)="deleteCategory(cat.id)" 
            class="btn-delete"
            [attr.aria-label]="'Delete ' + cat.name">
            √ó
          </button>
        </div>
      </div>


    </div>

    <!-- Quick Assign by Rows -->
    <div class="assign-section">
      <h3>Quick Assign Categories to Rows</h3>
      <div class="quick-assign-form">
        <div class="input-group">
          <label for="assign-category">Category</label>
          <select 
            id="assign-category"
            [ngModel]="quickAssignCategory()" 
            (ngModelChange)="quickAssignCategory.set($event)"
            aria-label="Select category to assign">
            <option value="">Select Category</option>
            <option *ngFor="let cat of categories()" [value]="cat.id">
              {{ cat.name }} (‚Çπ{{ cat.price }})
            </option>
          </select>
        </div>
        
        <div class="input-group">
          <label for="from-row">From Row</label>
          <select 
            id="from-row"
            [ngModel]="quickAssignFromRow()" 
            (ngModelChange)="quickAssignFromRow.set($event)"
            aria-label="From row">
            <option *ngFor="let r of [].constructor(rows()); let i = index" [value]="i">
              Row {{ getRowLabel(i) }}
            </option>
          </select>
        </div>
        
        <div class="input-group">
          <label for="to-row">To Row</label>
          <select 
            id="to-row"
            [ngModel]="quickAssignToRow()" 
            (ngModelChange)="quickAssignToRow.set($event)"
            aria-label="To row">
            <option *ngFor="let r of [].constructor(rows()); let i = index" [value]="i">
              Row {{ getRowLabel(i) }}
            </option>
          </select>
        </div>
        
        <button 
          (click)="applyQuickAssign()" 
          class="btn-apply"
          [disabled]="!quickAssignCategory()"
          aria-label="Apply category to selected rows">
          Apply to Rows
        </button>
      </div>
    </div>

    <!-- Seat Grid Preview -->
    <div class="preview-section">
      <div class="preview-header">
        <h3>Seat Layout Preview</h3>
      </div>
      
      <div class="screen-label" role="img" aria-label="Screen">SCREEN</div>
      
      <div class="legend" role="list" aria-label="Seat legend">
        <div *ngFor="let cat of categories()" class="legend-item" role="listitem">
          <div 
            class="legend-box" 
            [style.background]="cat.color"
            [attr.aria-label]="cat.name + ' category'"></div>
          <span>{{ cat.name }} (‚Çπ{{ cat.price }})</span>
        </div>
        <div class="legend-item" role="listitem">
          <div class="legend-box available" aria-label="Unassigned seat"></div>
          <span>Unassigned</span>
        </div>
        <div class="legend-item" role="listitem">
          <div class="legend-box disabled" aria-label="Disabled seat"></div>
          <span>Disabled</span>
        </div>
      </div>
      
      <div class="seats-grid" role="grid" aria-label="Seat map">
        <div 
          *ngFor="let r of [].constructor(rows()); let i = index" 
          class="seat-row"
          role="row">
          <span class="row-label" role="rowheader">{{ getRowLabel(i) }}</span>
          <div class="seats">
            <div
              *ngFor="let seat of getRowSeats(i)"
              class="seat"
              [style]="getSeatStyle(seat)"
              [class.disabled]="seat.status === 'disabled'"
              [attr.aria-label]="getSeatAriaLabel(seat)"
              role="gridcell">
              <span class="seat-label">{{ seat.label }}</span>
              <span class="seat-price" *ngIf="getSeatPrice(seat) > 0">‚Çπ{{ getSeatPrice(seat) }}</span>
              <select 
                *ngIf="seat.status !== 'disabled' && seat.status !== 'booked'"
                class="seat-category-select"
                [value]="seat.categoryId || ''"
                (change)="assignCategory(seat, $any($event.target).value)"
                [attr.aria-label]="'Assign category to ' + seat.label">
                <option value="">-</option>
                <option *ngFor="let cat of categories()" [value]="cat.id">{{ cat.name }}</option>
              </select>
              <button 
                *ngIf="seat.status !== 'booked'"
                class="seat-disable-btn"
                (click)="toggleSeatDisabled(seat)"
                [attr.aria-label]="seat.status === 'disabled' ? 'Enable seat' : 'Disable seat'">
                {{ seat.status === 'disabled' ? '‚úì' : '√ó' }}
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="seat-instructions">
        <p><strong>üí° Tip:</strong> Use dropdown to assign category ‚Ä¢ Click √ó to disable seat ‚Ä¢ Use Quick Assign for bulk operations</p>
      </div>
    </div>

    <!-- Save Section -->
    <div class="config-section" *ngIf="hasUnsavedChanges()">
      <div style="display: flex; gap: 12px; justify-content: flex-end;">
        <button 
          (click)="resetToSaved()" 
          class="btn-secondary"
          [disabled]="saving()">
          Reset
        </button>
        <button 
          (click)="saveScreen()" 
          class="btn-add"
          [disabled]="saving()">
          {{ saving() ? 'Saving...' : 'Save Configuration' }}
        </button>
      </div>
    </div>

  </div>

  <!-- Empty State -->
  <div *ngIf="!selectedScreenId() && !loading()" class="empty-state">
    <div class="empty-icon">üé≠</div>
    <h2>No Screen Selected</h2>
    <p>Select a theatre and screen above to start configuring seat layout and pricing</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>


</div>
