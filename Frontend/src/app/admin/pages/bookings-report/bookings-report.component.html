<div class="bookings-report-container">
  <div class="admin-page-header">
    <div class="admin-header-background"></div>
    <div class="admin-header-content">
      <div class="admin-header-text">
        <h1>Bookings Report</h1>
        <p>Comprehensive analytics and booking insights</p>
      </div>
      <div class="admin-header-actions">
        <button class="btn-secondary" (click)="exportReport()">
          <span class="icon">üìä</span>
          Export Report
        </button>
        <button class="btn-primary" (click)="refreshData()">
          <span class="icon">üîÑ</span>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <div class="loading-state" *ngIf="loading()">
    <div class="spinner"></div>
    <p>Loading bookings data...</p>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards" *ngIf="!loading()">
    <div class="summary-card">
      <div class="card-icon total">üìä</div>
      <div class="card-content">
        <h3>{{ totalBookings() }}</h3>
        <p>Total Bookings</p>
        <span class="trend positive">+12% from last month</span>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon revenue">üí∞</div>
      <div class="card-content">
        <h3>‚Çπ{{ totalRevenue() | number:'1.0-0' }}</h3>
        <p>Total Revenue</p>
        <span class="trend positive">+8% from last month</span>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon today">üìÖ</div>
      <div class="card-content">
        <h3>{{ todayBookings() }}</h3>
        <p>Today's Bookings</p>
        <span class="trend neutral">Same as yesterday</span>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon avg">üé´</div>
      <div class="card-content">
        <h3>{{ avgTicketsPerBooking() | number:'1.1-1' }}</h3>
        <p>Avg Tickets/Booking</p>
        <span class="trend positive">{{ cancelledBookings() }} cancelled</span>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="date-filters">
      <div class="date-group">
        <label>From Date:</label>
        <input type="date" [(ngModel)]="fromDate">
      </div>
      <div class="date-group">
        <label>To Date:</label>
        <input type="date" [(ngModel)]="toDate">
      </div>
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="selectedMovie">
        <option value="">All Movies</option>
        <option *ngFor="let movie of movies()" [value]="movie.title">{{ movie.title }}</option>
      </select>

      <select [(ngModel)]="selectedTheater">
        <option value="">All Theaters</option>
        <option *ngFor="let theater of theaters()" [value]="theater.name">{{ theater.name }}</option>
      </select>

      <select [(ngModel)]="selectedStatus">
        <option value="">All Status</option>
        <option value="CONFIRMED">Confirmed</option>
        <option value="CANCELLED">Cancelled</option>
        <option value="PENDING">Pending</option>
      </select>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section" *ngIf="!loading()">
    <div class="chart-card">
      <h3>Daily Bookings Trend (Last 7 Days)</h3>
      <div class="chart-placeholder">
        <div class="chart-bars" *ngIf="getDailyBookingsData().length > 0">
          <div class="bar" *ngFor="let count of getDailyBookingsData()" [style.height]="getBarHeight(count)"
            [title]="count + ' bookings'">
          </div>
        </div>
        <div class="chart-empty" *ngIf="getDailyBookingsData().length === 0">
          <p>No booking data available</p>
        </div>
        <!-- <div class="chart-labels">
          <span *ngFor="let i of [6,5,4,3,2,1,0]">
            {{ new Date(new Date().setDate(new Date().getDate() - i)) | date:'EEE' }}
          </span>
        </div> -->
        <div class="chart-labels">
          <span *ngFor="let label of weekDayLabels()">
            {{ label }}
          </span>
        </div>
      </div>
    </div>

    <div class="chart-card">
      <h3>Popular Movies</h3>
      <div class="popular-movies" *ngIf="getPopularMovies().length > 0">
        <div class="movie-stat" *ngFor="let movie of getPopularMovies()">
          <span class="movie-name">{{ movie.title }}</span>
          <div class="progress-bar">
            <div class="progress" [style.width.%]="movie.percentage"></div>
          </div>
          <span class="percentage">{{ movie.bookings }} bookings</span>
        </div>
      </div>
      <div class="chart-empty" *ngIf="getPopularMovies().length === 0">
        <p>No movie data available</p>
      </div>
    </div>
  </div>

  <!-- Bookings Table -->
  <div class="table-section" *ngIf="!loading()">
    <div class="table-header">
      <h3>Recent Bookings</h3>
      <div class="table-actions">
        <input type="text" placeholder="Search bookings..." [(ngModel)]="searchTerm"
          class="search-input">
      </div>
    </div>

    <div class="table-container">
      <table class="bookings-table">
        <thead>
          <tr>
            <th>Booking ID</th>
            <th>Customer</th>
            <th>Movie</th>
            <th>Theater</th>
            <th>Show Date</th>
            <th>Seats</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let booking of paginatedBookings(); trackBy: trackByBookingId">
            <td class="booking-id">#{{ booking.id }}</td>
            <td>
              <div class="customer-info">
                <strong>{{ booking.customerName }}</strong>
                <small>{{ booking.customerEmail }}</small>
              </div>
            </td>
            <td>{{ booking.movieTitle }}</td>
            <td>{{ booking.theaterName }}</td>
            <td>{{ booking.showtime | date:'MMM dd, yyyy h:mm a' }}</td>
            <td>
              <span class="seats-count">
                {{ booking.seats.length || 0 }} seats
              </span>

              <small *ngIf="booking.seats.length > 0">
                {{ booking.seats.join(', ') }}
              </small>
            </td>
            <td class="amount">{{ formatCurrency(booking.totalAmount || 0) }}</td>
            <td>
              <span class="status-badge" [class]="'status-' + booking.status.toLowerCase()">
                {{ booking.status }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon" (click)="viewBooking(booking)" title="View Details">
                  üëÅÔ∏è
                </button>
                <button class="btn-icon" (click)="downloadTicket(booking)" title="Download Ticket">
                  üìÑ
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="table-pagination">
      <span class="pagination-info">
        Showing {{ (currentPage() - 1) * itemsPerPage() + 1 }} to
        {{ getEndIndex() }}
        of {{ filteredBookings().length }} bookings
      </span>
      <div class="pagination-controls">
        <button class="btn-pagination" [disabled]="currentPage() === 1" (click)="previousPage()">
          Previous
        </button>
        <span class="page-info">Page {{ currentPage() }} of {{ totalPages() }}</span>
        <button class="btn-pagination" [disabled]="currentPage() === totalPages()" (click)="nextPage()">
          Next
        </button>
      </div>
    </div>
  </div>
</div>