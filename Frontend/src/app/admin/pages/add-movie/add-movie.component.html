<div class="add-movie-page">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">{{ getPageTitle() }}</h1>
    <p class="page-subtitle">{{ isEditMode() ? 'Update movie information' : 'Create a new movie listing for your theater' }}</p>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading movie details...</p>
    </div>
  }

  @if (!loading()) {
    <div class="form-card">
      <form [formGroup]="movieForm" (ngSubmit)="onSubmit()">
        
        <!-- Basic Details Section -->
        <div class="section-header">
          <h3>Basic Details</h3>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="title">üé¨ Movie Title *</label>
            <input 
              type="text" 
              id="title" 
              formControlName="title"
              placeholder="Enter movie title"
              [class.error]="movieForm.get('title')?.invalid && movieForm.get('title')?.touched">
            @if (movieForm.get('title')?.invalid && movieForm.get('title')?.touched) {
              <span class="error-message">{{ getFieldError('title') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="director">üé• Director</label>
            <input 
              type="text" 
              id="director" 
              formControlName="director"
              placeholder="Enter director name">
          </div>

          <div class="form-group">
            <label for="duration">‚è±Ô∏è Duration (minutes) *</label>
            <input 
              type="number" 
              id="duration" 
              formControlName="duration"
              placeholder="120"
              min="1"
              [class.error]="movieForm.get('duration')?.invalid && movieForm.get('duration')?.touched">
            @if (movieForm.get('duration')?.invalid && movieForm.get('duration')?.touched) {
              <span class="error-message">{{ getFieldError('duration') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="language">üåê Language *</label>
            <select 
              id="language" 
              formControlName="language"
              [class.error]="movieForm.get('language')?.invalid && movieForm.get('language')?.touched">
              <option value="" disabled>Select Language</option>
              <option value="English">English</option>
              <option value="Hindi">Hindi</option>
              <option value="Tamil">Tamil</option>
              <option value="Telugu">Telugu</option>
              <option value="Malayalam">Malayalam</option>
              <option value="Kannada">Kannada</option>
              <option value="Bengali">Bengali</option>
              <option value="Marathi">Marathi</option>
              <option value="Punjabi">Punjabi</option>
              <option value="Gujarati">Gujarati</option>
              @for (lang of availableLanguages(); track lang) {
                <option [value]="lang">{{ lang }}</option>
              }
            </select>
            @if (movieForm.get('language')?.invalid && movieForm.get('language')?.touched) {
              <span class="error-message">{{ getFieldError('language') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="releaseDate">üìÖ Release Date *</label>
            <input 
              type="date" 
              id="releaseDate" 
              formControlName="releaseDate"
              [class.error]="movieForm.get('releaseDate')?.invalid && movieForm.get('releaseDate')?.touched">
            @if (movieForm.get('releaseDate')?.invalid && movieForm.get('releaseDate')?.touched) {
              <span class="error-message">{{ getFieldError('releaseDate') }}</span>
            }
          </div>
        </div>

        <!-- Genre Selection & Description -->
        <div class="form-grid">
          <div class="form-group">
            <label>üé≠ Genre * <span class="hint-inline">(Select multiple)</span></label>
            <div class="genre-chips-container">
              @for (genre of availableGenres; track genre) {
                <button 
                  type="button"
                  class="genre-chip"
                  [class.selected]="selectedGenres().includes(genre)"
                  (click)="toggleGenre(genre)">
                  {{ genre }}
                </button>
              }
            </div>
            @if (selectedGenres().length > 0) {
              <div class="selected-count">
                ‚úì {{ selectedGenres().length }} genre(s) selected: {{ selectedGenres().join(', ') }}
              </div>
            } @else {
              <small class="hint">Please select at least one genre</small>
            }
          </div>

          <div class="form-group">
            <label for="description">üìù Description *</label>
            <textarea 
              id="description" 
              formControlName="description"
              placeholder="Enter a compelling movie description..."
              rows="8"
              [class.error]="movieForm.get('description')?.invalid && movieForm.get('description')?.touched"></textarea>
            @if (movieForm.get('description')?.invalid && movieForm.get('description')?.touched) {
              <span class="error-message">{{ getFieldError('description') }}</span>
            }
          </div>
        </div>

        <!-- Media Assets Section -->
        <div class="section-header">
          <h3>Media Assets</h3>
          <p class="section-subtitle">Upload poster, background image, and trailer for the movie</p>
        </div>
        
        <div class="media-grid">
          <!-- Poster Upload -->
          <div class="media-card">
            <label class="media-label">üñºÔ∏è Poster Image</label>
            <p class="media-hint">Vertical poster (recommended: 300x450px)</p>
            
            <div class="file-upload-wrapper">
              <input 
                type="file" 
                id="posterFile" 
                accept="image/*"
                (change)="onPosterFileChange($event)"
                class="file-input">
              <label for="posterFile" class="file-label">
                @if (loadingPoster()) {
                  <span class="spinner-small"></span>
                  <span>Loading...</span>
                } @else {
                  <span>üì§</span>
                  <span>Choose Image</span>
                }
              </label>
            </div>
            
            <div class="url-divider">OR</div>
            
            <div class="url-input-group">
              <input 
                type="text" 
                id="posterUrl" 
                formControlName="posterUrl"
                placeholder="https://example.com/poster.jpg"
                [disabled]="loadingPoster()">
              <button 
                type="button" 
                class="load-btn" 
                (click)="loadPosterPreview()"
                [disabled]="loadingPoster() || !movieForm.get('posterUrl')?.value">
                @if (loadingPoster()) {
                  <span class="spinner-small"></span>
                } @else {
                  <span>Load</span>
                }
              </button>
            </div>
            
            @if (posterPreview() && isImage(posterPreview())) {
              <div class="preview-box poster-preview">
                <img [src]="posterPreview()" alt="Poster preview">
                <div class="preview-label">‚úì Poster Loaded</div>
              </div>
            }
          </div>

          <!-- Background Upload -->
          <div class="media-card">
            <label class="media-label">üåÑ Background Image</label>
            <p class="media-hint">Wide background for slider & details (1920x1080px)</p>
            
            <div class="file-upload-wrapper">
              <input 
                type="file" 
                id="backgroundFile" 
                accept="image/*"
                (change)="onBackgroundFileChange($event)"
                class="file-input">
              <label for="backgroundFile" class="file-label">
                @if (loadingBackground()) {
                  <span class="spinner-small"></span>
                  <span>Loading...</span>
                } @else {
                  <span>üì§</span>
                  <span>Choose Image</span>
                }
              </label>
            </div>
            
            <div class="url-divider">OR</div>
            
            <div class="url-input-group">
              <input 
                type="text" 
                id="backgroundUrl" 
                formControlName="backgroundUrl"
                placeholder="https://example.com/background.jpg"
                [disabled]="loadingBackground()">
              <button 
                type="button" 
                class="load-btn" 
                (click)="loadBackgroundPreview()"
                [disabled]="loadingBackground() || !movieForm.get('backgroundUrl')?.value">
                @if (loadingBackground()) {
                  <span class="spinner-small"></span>
                } @else {
                  <span>Load</span>
                }
              </button>
            </div>
            
            @if (backgroundPreview() && isImage(backgroundPreview())) {
              <div class="preview-box background-preview">
                <img [src]="backgroundPreview()" alt="Background preview">
                <div class="preview-label">‚úì Background Loaded</div>
              </div>
            }
          </div>

          <!-- Trailer Upload -->
          <div class="media-card">
            <label class="media-label">üéûÔ∏è Trailer Video</label>
            <p class="media-hint">Movie trailer (YouTube URL or video file)</p>
            
            <div class="file-upload-wrapper">
              <input 
                type="file" 
                id="trailerFile" 
                accept="video/*"
                (change)="onTrailerFileChange($event)"
                class="file-input">
              <label for="trailerFile" class="file-label">
                @if (loadingTrailer()) {
                  <span class="spinner-small"></span>
                  <span>Loading...</span>
                } @else {
                  <span>üì§</span>
                  <span>Choose Video</span>
                }
              </label>
            </div>
            
            <div class="url-divider">OR</div>
            
            <div class="url-input-group">
              <input 
                type="text" 
                id="trailerUrl" 
                formControlName="trailerUrl"
                placeholder="https://youtube.com/watch?v=... or video URL"
                [disabled]="loadingTrailer()">
              <button 
                type="button" 
                class="load-btn" 
                (click)="loadTrailerPreview()"
                [disabled]="loadingTrailer() || !movieForm.get('trailerUrl')?.value">
                @if (loadingTrailer()) {
                  <span class="spinner-small"></span>
                } @else {
                  <span>Load</span>
                }
              </button>
            </div>
            
            @if (trailerPreview()) {
              <div class="preview-box trailer-preview">
                @if (isYouTubeUrl(trailerPreview())) {
                  <iframe 
                    [src]="getYouTubeEmbedUrl(trailerPreview())" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                  </iframe>
                } @else {
                  <video [src]="trailerPreview()" controls controlsList="nodownload"></video>
                }
                <div class="preview-label">‚úì Trailer Loaded</div>
              </div>
            }
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="onCancel()" [disabled]="submitting()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn-primary" 
            [disabled]="movieForm.invalid || selectedGenres().length === 0 || submitting()">
            @if (submitting()) {
              <span class="spinner-small"></span>
              <span>{{ isEditMode() ? 'Updating...' : 'Adding...' }}</span>
            } @else {
              <span>{{ getSubmitButtonText() }}</span>
            }
          </button>
        </div>
      </form>
    </div>
  }
</div>
