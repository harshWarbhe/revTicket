<div class="my-bookings-container">
  <div class="page-header">
    <h1>My Bookings</h1>
    <p>View and manage your movie ticket bookings</p>
  </div>

  <div class="bookings-filters">
    <div class="filter-tabs">
      <button 
        class="filter-tab" 
        [class.active]="activeFilter() === 'all'"
        (click)="setFilter('all')">
        All Bookings
      </button>
      <button 
        class="filter-tab" 
        [class.active]="activeFilter() === 'upcoming'"
        (click)="setFilter('upcoming')">
        Upcoming
      </button>
      <button 
        class="filter-tab" 
        [class.active]="activeFilter() === 'past'"
        (click)="setFilter('past')">
        Past
      </button>
      <button 
        class="filter-tab" 
        [class.active]="activeFilter() === 'cancelled'"
        (click)="setFilter('cancelled')">
        Cancelled
      </button>
    </div>
    
    <div class="search-box">
      <input 
        type="text" 
        placeholder="Search bookings..." 
        [(ngModel)]="searchTerm">
      <span class="search-icon">üîç</span>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-state">
      Loading your bookings...
    </div>
  }

  @if (!loading() && filteredBookings().length > 0) {
    <div class="bookings-list">
      @for (booking of filteredBookings(); track booking.id) {
        <div class="booking-card">
          <div class="booking-header">
            <div class="movie-info">
              <img 
                [src]="booking.moviePosterUrl || 'assets/images/movies/default-poster.png'" 
                [alt]="booking.movieTitle"
                class="movie-poster"
                (error)="onImageError($event)">
              <div class="movie-details">
                <h3>{{ booking.movieTitle }}</h3>
                <p class="movie-meta">{{ booking.theaterName }}</p>
              </div>
            </div>
            
            <div class="booking-status">
              <span 
                class="status-badge status-{{ booking.status.toLowerCase() }}">
                {{ booking.status | titlecase }}
              </span>
              <div class="booking-id">
                #{{ booking.id }}
              </div>
            </div>
          </div>

          <div class="booking-details">
            <div class="detail-row">
              <div class="detail-item">
                <span class="label">Theater:</span>
                <span class="value">{{ booking.theaterName }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Screen:</span>
                <span class="value">{{ booking.screen }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Date & Time:</span>
                <span class="value">{{ booking.showtime | date:'MMM dd, yyyy - h:mm a' }}</span>
              </div>
            </div>
            
            <div class="detail-row">
              <div class="detail-item">
                <span class="label">Seats:</span>
                <span class="value">{{ (booking.seatLabels || booking.seats).join(', ') }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Total Amount:</span>
                <span class="value amount">‚Çπ{{ booking.totalAmount }}</span>
              </div>
            </div>
          </div>

          <div class="booking-actions">
            @if (booking.status === 'CONFIRMED') {
              <button 
                class="btn-secondary" 
                (click)="downloadTicket(booking)">
                <span class="icon">üìÑ</span>
                Download Ticket
              </button>
              
              <button 
                class="btn-secondary" 
                (click)="viewTicket(booking)">
                <span class="icon">üé´</span>
                View E-Ticket
              </button>
            }
            
            @if (booking.status === 'CONFIRMED' && canCancel(booking)) {
              <button 
                class="btn-danger" 
                (click)="cancelBooking(booking)">
                <span class="icon">‚ùå</span>
                Cancel Booking
              </button>
            }
            
            @if (isPendingCancellation(booking)) {
              <div class="refund-info">
                <small>‚è≥ Cancellation request pending admin approval</small>
              </div>
            }
            
            @if (booking.status === 'CANCELLED' && getRefundInfo(booking)) {
              <div class="refund-info">
                <small>{{ getRefundInfo(booking) }}</small>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }

  @if (!loading() && filteredBookings().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">üé´</div>
      <h3>No Bookings Found</h3>
      <p>{{ getEmptyStateMessage() }}</p>
      @if (activeFilter() === 'all') {
        <button class="btn-primary" routerLink="/user/home">
          Book Your First Movie
        </button>
      }
    </div>
  }

  @if (showTicket()) {
    <div class="modal-overlay" (click)="closeTicket()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="closeTicket()">√ó</button>
        @if (selectedBooking()) {
          <app-e-ticket [booking]="selectedBooking()!"></app-e-ticket>
        }
      </div>
    </div>
  }
</div>
