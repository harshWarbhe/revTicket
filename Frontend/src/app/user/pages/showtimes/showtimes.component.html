<div class="showtimes-page">
  @if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading showtimes...</p>
    </div>
  } @else {
    <!-- Movie Header -->
    @if (movie()) {
      <div class="movie-header">
        <div class="header-container">
          <div class="movie-info">
            <h1>{{ movie()!.title }}</h1>
            <div class="meta">
              <span class="rating">‚≠ê {{ movie()!.rating }}/10</span>
              <span>{{ movie()!.genre.join(', ') }}</span>
              <span>{{ movie()!.duration }} mins</span>
            </div>
          </div>
        </div>
      </div>
    }

    <!-- Date Selector -->
    <div class="date-selector-section">
      <div class="container">
        <div class="date-scroll">
          @for (date of dates(); track date) {
            <div class="date-card" 
                 [class.active]="formatDate(date) === formatDate(selectedDate())"
                 (click)="selectDate(date)">
              <div class="date-day">
                @if (isToday(date)) {
                  <span>Today</span>
                } @else if (isTomorrow(date)) {
                  <span>Tomorrow</span>
                } @else {
                  <span>{{ date | date:'EEE' }}</span>
                }
              </div>
              <div class="date-num">{{ date | date:'d' }}</div>
              <div class="date-month">{{ date | date:'MMM' }}</div>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
      <div class="container">
        <div class="filters-row">
          <!-- Language Filter -->
          <div class="filter-group">
            <label>Language</label>
            <div class="filter-chips">
              @for (lang of languages(); track lang) {
                <button class="chip" 
                        [class.active]="selectedLanguage() === lang"
                        (click)="selectLanguage(lang)">
                  {{ lang }}
                </button>
              }
            </div>
          </div>

          <!-- Format Filter -->
          <div class="filter-group">
            <label>Format</label>
            <div class="filter-chips">
              @for (format of formats(); track format) {
                <button class="chip" 
                        [class.active]="selectedFormat() === format"
                        (click)="selectFormat(format)">
                  {{ format }}
                </button>
              }
            </div>
          </div>

          <!-- Price Filter -->
          <div class="filter-group">
            <label>Price Range</label>
            <div class="filter-chips">
              <button class="chip" 
                      [class.active]="priceRange() === 'All'"
                      (click)="selectPriceRange('All')">
                All
              </button>
              <button class="chip" 
                      [class.active]="priceRange() === '0-200'"
                      (click)="selectPriceRange('0-200')">
                ‚Çπ0-200
              </button>
              <button class="chip" 
                      [class.active]="priceRange() === '200-400'"
                      (click)="selectPriceRange('200-400')">
                ‚Çπ200-400
              </button>
              <button class="chip" 
                      [class.active]="priceRange() === '400-1000'"
                      (click)="selectPriceRange('400-1000')">
                ‚Çπ400+
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cinema Listings -->
    <div class="cinema-section">
      <div class="container">
        @if (theaterGroups().length === 0) {
          <div class="empty-state">
            <div class="empty-icon">üé¨</div>
            <h3>No Shows Available</h3>
            <p>{{ error() || 'No showtimes match your filters' }}</p>
          </div>
        } @else {
          @for (theater of theaterGroups(); track theater.theaterId) {
            <div class="cinema-card">
              <div class="cinema-header">
                <div class="cinema-info">
                  <div class="cinema-icon">üé≠</div>
                  <div class="cinema-details">
                    <h3>{{ theater.theaterName }}</h3>
                    <p>{{ theater.location }}</p>
                  </div>
                </div>
                <div class="cinema-meta">
                  <span class="info-icon">‚ÑπÔ∏è</span>
                </div>
              </div>

              <div class="showtimes-container">
                @for (show of theater.showtimes; track show.id) {
                  <button class="showtime-btn" 
                          [class]="getAvailabilityStatus(show.availableSeats, show.totalSeats)"
                          (click)="selectShowtime(show.id)">
                    <div class="time">{{ show.showDateTime | date:'h:mm a' }}</div>
                    <div class="screen">{{ show.screen }}</div>
                    <div class="price">‚Çπ{{ show.ticketPrice }}</div>
                    @if (getAvailabilityStatus(show.availableSeats, show.totalSeats) === 'fast-filling') {
                      <div class="badge">Fast Filling</div>
                    }
                    @if (getAvailabilityStatus(show.availableSeats, show.totalSeats) === 'sold-out') {
                      <div class="badge">Sold Out</div>
                    }
                  </button>
                }
              </div>
            </div>
          }
        }
      </div>
    </div>
  }
</div>
