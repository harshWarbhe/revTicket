<div class="e-ticket-wrapper" #ticketContent>
  @if (booking(); as booking) {
    <div class="e-ticket">
      <!-- Ticket Header -->
      <div class="ticket-header">
        <div class="brand-section">
          <div class="brand-logo">üé¨</div>
          <div class="brand-info">
            <h1 class="brand-name">RevTicket</h1>
            <p class="brand-tagline">Your Movie Experience Partner</p>
          </div>
        </div>
        <div class="ticket-number-section">
          <span class="ticket-label">TICKET NO.</span>
          <span class="ticket-number">{{ booking.ticketNumber || booking.id.substring(0, 8).toUpperCase() }}</span>
        </div>
      </div>

      <!-- Movie Section -->
      <div class="movie-section">
        @if (booking.moviePosterUrl) {
          <div class="movie-poster-container">
            <img [src]="booking.moviePosterUrl" [alt]="booking.movieTitle" class="movie-poster">
          </div>
        }
        <div class="movie-info">
          <h2 class="movie-title">{{ booking.movieTitle }}</h2>
          <div class="status-badge" [ngClass]="'status-' + booking.status.toLowerCase()">
            {{ booking.status === 'CANCEL' ? 'PENDING CANCELLATION' : booking.status }}
          </div>
        </div>
      </div>

    <!-- Booking Details -->
    <div class="booking-details">
      <div class="details-grid">
        <div class="detail-item">
          <div class="detail-icon">üè¢</div>
          <div class="detail-content">
            <span class="detail-label">Theatre</span>
            <span class="detail-value">{{ booking.theaterName }}</span>
            @if (booking.theaterLocation) {
              <span class="detail-sub">{{ booking.theaterLocation }}</span>
            }
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">üì∫</div>
          <div class="detail-content">
            <span class="detail-label">Screen</span>
            <span class="detail-value">{{ booking.screen || 'N/A' }}</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">üìÖ</div>
          <div class="detail-content">
            <span class="detail-label">Show Date & Time</span>
            <span class="detail-value">{{ formatDateTime(booking.showtime) }}</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">üí∫</div>
          <div class="detail-content">
            <span class="detail-label">Seats</span>
            <div class="seats-container">
              @for (seat of (booking.seatLabels || booking.seats); track seat) {
                <span class="seat-badge">
                  {{ seat }}
                </span>
              }
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Customer Details -->
    <div class="customer-section">
      <h3 class="section-title">Customer Details</h3>
      <div class="customer-grid">
        <div class="customer-item">
          <span class="customer-label">Name</span>
          <span class="customer-value">{{ booking.customerName }}</span>
        </div>
        <div class="customer-item">
          <span class="customer-label">Email</span>
          <span class="customer-value">{{ booking.customerEmail }}</span>
        </div>
        <div class="customer-item">
          <span class="customer-label">Phone</span>
          <span class="customer-value">{{ booking.customerPhone }}</span>
        </div>
      </div>
    </div>

    <!-- Payment Section -->
    <div class="payment-section">
      <div class="payment-row">
        <span class="payment-label">Total Amount Paid</span>
        <span class="payment-amount">{{ formatCurrency(booking.totalAmount) }}</span>
      </div>
      <div class="payment-row">
        <span class="payment-label">Booking ID</span>
        <span class="payment-value">{{ booking.id }}</span>
      </div>
      <div class="payment-row">
        <span class="payment-label">Booking Date</span>
        <span class="payment-value">{{ formatDate(booking.bookingDate) }}</span>
      </div>
      @if (booking.paymentId) {
        <div class="payment-row">
          <span class="payment-label">Payment ID</span>
          <span class="payment-value">{{ booking.paymentId }}</span>
        </div>
      }
    </div>

      <!-- QR Code Section -->
      <div class="qr-section">
        <div class="qr-container">
          @if (qrCodeDataUrl) {
            <img [src]="qrCodeDataUrl" alt="QR Code" class="qr-code">
          } @else {
            <div class="qr-placeholder">
              <div class="qr-loading">Generating QR Code...</div>
            </div>
          }
        </div>
      <div class="qr-instructions">
        <p class="qr-title">Show this QR code at the theatre entrance</p>
        <p class="qr-subtitle">Scan to verify booking details</p>
      </div>
    </div>

    <!-- Terms & Conditions -->
    <div class="terms-section">
      <h4 class="terms-title">Important Instructions</h4>
      <ul class="terms-list">
        <li>Please arrive at least 30 minutes before showtime</li>
        <li>Carry a valid ID proof for verification</li>
        <li>Outside food and beverages are not allowed</li>
        <li>This ticket is non-transferable and valid only for the mentioned show</li>
        <li>No refund will be provided after the show starts</li>
      </ul>
    </div>

      <!-- Refund Info (if cancelled) -->
      @if (booking.status === 'CANCELLED' && booking.refundAmount) {
        <div class="refund-section">
          <div class="refund-alert">
            <div class="refund-icon">üí∞</div>
            <div class="refund-info">
              <p class="refund-title">Refund Processed</p>
              <p class="refund-amount">{{ formatCurrency(booking.refundAmount) }}</p>
              <p class="refund-date">Refunded on {{ formatDate(booking.refundDate!) }}</p>
            </div>
          </div>
        </div>
      }

      <!-- Footer -->
      <div class="ticket-footer">
        <p class="footer-text">Thank you for choosing RevTicket! Enjoy your movie! üçø</p>
        <p class="footer-support">For support, contact: support&#64;revticket.com | +91-1800-XXX-XXXX</p>
      </div>
    </div>
  }
</div>

<!-- Action Buttons (Not included in print/PDF) -->
@if (booking()) {
  <div class="ticket-actions">
    <button class="action-btn btn-download" (click)="downloadPDF()">
      <span class="btn-icon">üì•</span>
      <span class="btn-text">Download PDF</span>
    </button>
    <button class="action-btn btn-share" (click)="shareTicket()">
      <span class="btn-icon">üì§</span>
      <span class="btn-text">Share Ticket</span>
    </button>
    <button class="action-btn btn-print" (click)="printTicket()">
      <span class="btn-icon">üñ®Ô∏è</span>
      <span class="btn-text">Print</span>
    </button>
  </div>
}
